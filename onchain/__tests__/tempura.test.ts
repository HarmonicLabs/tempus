import { Machine, PScriptContext, PTxOutRef, TxOutRef, UPLCConst, data, dataFromCbor, lam, pData, punsafeConvertType, unit } from "@harmoniclabs/plu-ts";
import { Redeemer, tempura } from "../tempura";

describe("tempura", () => {

    test("mine", () => {

        const contract = tempura.$(
            PTxOutRef.fromData(
                pData(
                    new TxOutRef({
                        "id": "1cd30f11c3d774fa1cb43620810a405e6048c8ecea2e85ff43f5c3ad08096e46",
                        "index": 1
                    }).toData()
                )
            )
        );

        const datumData = dataFromCbor("d8799f00582071eb1a4896739027745df976a065ded7ffd4e6371a2a9256999f59371b50b36a0519ffff001b0000018a5b512a340080ff");
        const rdmrData  = dataFromCbor("d87a9f50842b09bb0f88bf1232901043701534ceff");
        const ctxData   = dataFromCbor(
            "D87982D8798C82D87982D87982D87981582012CC3906A43731477E63522A24CBB5EAF74046BF7B44F600D8F062ECAC331B7100D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A240A1401A001898F4581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A1466974616D616501D87B81D8798800582071EB1A4896739027745DF976A065DED7FFD4E6371A2A9256999F59371B50B36A05193FFF001B0000018A5B512A340080D87A80D87982D87982D879815820FBBCE31D47E45AF499BAFF9446C99CCBC2E80DB613467DBC5FFEA2F3BB10A8A201D87984D87982D87981581C13867B04DB054CAA9655378FE37FEDEE7029924FBE1243887DC35FD8D87A80A140A1401B000000024EFC84FFD87980D87A8082D87982D87982D879815820FBBCE31D47E45AF499BAFF9446C99CCBC2E80DB613467DBC5FFEA2F3BB10A8A200D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A140A1401A0128CCE6D87B8100D87981581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87982D87982D879815820FBBCE31D47E45AF499BAFF9446C99CCBC2E80DB613467DBC5FFEA2F3BB10A8A200D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A140A1401A0128CCE6D87B8100D87981581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C27882D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A240A1401A001898F4581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A1466974616D616501D87B81D8798801582000000F3B69E1436D48366F34C2E217CF598DC2F886D7DC5BB56688B8365A748B05193FFF1A000A75BC1B0000018A5B5B9FF00080D87A80D87984D87982D87981581C13867B04DB054CAA9655378FE37FEDEE7029924FBE1243887DC35FD8D87A80A240A1401B000000024EF9AC02581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A14754454D505552411B000000012A05F200D87980D87A80A140A1401A0002D8FDA240A14000581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A14754454D505552411B000000012A05F20080A0D87982D87982D87A811B0000018A5B5A4060D87980D87982D87A811B0000018A5B5CFF80D8798080A2D87A81D87982D87981582012CC3906A43731477E63522A24CBB5EAF74046BF7B44F600D8F062ECAC331B7100D87A8150842B09BB0F88BF1232901043701534CED87981581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87980A05820198CA261BC2C0F39E64132C19CD2B2E38DFFC4F5594EC195D8750013F73F1B7BD87A81D87982D87981582012CC3906A43731477E63522A24CBB5EAF74046BF7B44F600D8F062ECAC331B7100"
        );

        const res = Machine.eval(
            punsafeConvertType(
                contract
                .$( pData( datumData ) )
                .$( Redeemer.fromData( pData( rdmrData ) ) ),
                lam( data, unit )
            )
            .$( pData( ctxData ) )
        );

        // console.log( res );
        // console.log(
        //     (res as any)?.result?.addInfos?.list?.value ??
        //     (res as any)?.result?.addInfos?.data ??
        //     (res as any)?.result?.addInfos ??
        //     (res as any)?.result
        // );

        expect( res.result instanceof UPLCConst ).toBe( true );
        expect( res.result ).toEqual( UPLCConst.unit );
    })
})