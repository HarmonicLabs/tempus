import { Machine, PScriptContext, PTxOutRef, TxOutRef, UPLCConst, data, dataFromCbor, lam, pData, punsafeConvertType, unit } from "@harmoniclabs/plu-ts";
import { Redeemer, tempura } from "../tempura";

describe("tempura", () => {

    test("mine 0", () => {

        const contract = tempura.$(
            PTxOutRef.fromData(
                pData(
                    new TxOutRef({
                        "id": "1cd30f11c3d774fa1cb43620810a405e6048c8ecea2e85ff43f5c3ad08096e46",
                        "index": 1
                    }).toData()
                )
            )
        );

        const datumData = dataFromCbor("d8799f00582071eb1a4896739027745df976a065ded7ffd4e6371a2a9256999f59371b50b36a0519ffff001b0000018a5b512a340080ff");
        const rdmrData  = dataFromCbor("d87a9f50842b09bb0f88bf1232901043701534ceff");
        const ctxData   = dataFromCbor(
            "D87982D8798C82D87982D87982D87981582012CC3906A43731477E63522A24CBB5EAF74046BF7B44F600D8F062ECAC331B7100D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A240A1401A001898F4581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A1466974616D616501D87B81D8798800582071EB1A4896739027745DF976A065DED7FFD4E6371A2A9256999F59371B50B36A05193FFF001B0000018A5B512A340080D87A80D87982D87982D879815820FBBCE31D47E45AF499BAFF9446C99CCBC2E80DB613467DBC5FFEA2F3BB10A8A201D87984D87982D87981581C13867B04DB054CAA9655378FE37FEDEE7029924FBE1243887DC35FD8D87A80A140A1401B000000024EFC84FFD87980D87A8082D87982D87982D879815820FBBCE31D47E45AF499BAFF9446C99CCBC2E80DB613467DBC5FFEA2F3BB10A8A200D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A140A1401A0128CCE6D87B8100D87981581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87982D87982D879815820FBBCE31D47E45AF499BAFF9446C99CCBC2E80DB613467DBC5FFEA2F3BB10A8A200D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A140A1401A0128CCE6D87B8100D87981581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C27882D87984D87982D87A81581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87A80A240A1401A001898F4581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A1466974616D616501D87B81D8798801582000000F3B69E1436D48366F34C2E217CF598DC2F886D7DC5BB56688B8365A748B05193FFF1A000A75BC1B0000018A5B5B9FF00080D87A80D87984D87982D87981581C13867B04DB054CAA9655378FE37FEDEE7029924FBE1243887DC35FD8D87A80A240A1401B000000024EF9AC02581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A14754454D505552411B000000012A05F200D87980D87A80A140A1401A0002D8FDA240A14000581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278A14754454D505552411B000000012A05F20080A0D87982D87982D87A811B0000018A5B5A4060D87980D87982D87A811B0000018A5B5CFF80D8798080A2D87A81D87982D87981582012CC3906A43731477E63522A24CBB5EAF74046BF7B44F600D8F062ECAC331B7100D87A8150842B09BB0F88BF1232901043701534CED87981581CC9981006C4ABF1EAB96A0C87B0EE3D40B8007CD4C9B3D0DEA357C278D87980A05820198CA261BC2C0F39E64132C19CD2B2E38DFFC4F5594EC195D8750013F73F1B7BD87A81D87982D87981582012CC3906A43731477E63522A24CBB5EAF74046BF7B44F600D8F062ECAC331B7100"
        );

        const res = Machine.eval(
            punsafeConvertType(
                contract
                .$( pData( datumData ) )
                .$( Redeemer.fromData( pData( rdmrData ) ) ),
                lam( data, unit )
            )
            .$( pData( ctxData ) )
        );

        // console.log( res );
        // console.log(
        //     (res as any)?.result?.addInfos?.list?.value ??
        //     (res as any)?.result?.addInfos?.data ??
        //     (res as any)?.result?.addInfos ??
        //     (res as any)?.result
        // );

        expect( res.result instanceof UPLCConst ).toBe( true );
        expect( res.result ).toEqual( UPLCConst.unit );
    });

    test.skip("mine 1", () => {

        const contract = tempura.$(
            PTxOutRef.fromData(
                pData(
                    new TxOutRef({
                        "id": "1cd30f11c3d774fa1cb43620810a405e6048c8ecea2e85ff43f5c3ad08096e46",
                        "index": 1
                    }).toData()
                )
            )
        );

        const datumData = dataFromCbor("d8799f005820260139cebfa78d9b75b9df5d906d827d13dfd632e6cb2ef2c709fe23ed8128ec0519ffff001b0000018a89e1877c0080ff");
        const rdmrData  = dataFromCbor("d87a9f503e8705789654a9a17fd08a91489591a4ff");
        const ctxData   = dataFromCbor(
            "8799fd8799f9fd8799fd8799fd8799f58202b5d1a4b36d928da9a48c53a1013656e559db63f1ec86c9673e1839e2b7999efff00ffd8799fd8799fd87a9f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffd87a80ffbf40bf401a001898f4ff581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5bf466974616d616501ffffd87b9fd8799f005820260139cebfa78d9b75b9df5d906d827d13dfd632e6cb2ef2c709fe23ed8128ec0519ffff001b0000018a89e1877c0080ffffd87a80ffffd8799fd8799fd8799f58202576dbe880b051a3e630605c315f291c9d0ad4de100ec8ffd11e0031cd3ca9a9ff01ffd8799fd8799fd8799f581c13867b04db054caa9655378fe37fedee7029924fbe1243887dc35fd8ffd87a80ffbf40bf401b000000024d56e117ffffd87980d87a80ffffff9fd8799fd8799fd8799f58202576dbe880b051a3e630605c315f291c9d0ad4de100ec8ffd11e0031cd3ca9a9ff00ffd8799fd8799fd87a9f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffd87a80ffbf40bf401a00f6afeaffffd87b9f00ffd8799f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffffffd8799fd8799fd8799f58202576dbe880b051a3e630605c315f291c9d0ad4de100ec8ffd11e0031cd3ca9a9ff00ffd8799fd8799fd87a9f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffd87a80ffbf40bf401a00f6afeaffffd87b9f00ffd8799f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffffffff9fd8799fd8799fd87a9f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffd87a80ffbf40bf401a001898f4ff581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5bf466974616d616501ffffd87b9fd8799f015820000008e2add4952826b1aac45abdd431af1e96bfe4d0b06dc9fed63c434b1a8b05193fff001b0000018a89e6a6080080ffffd87a80ffd8799fd8799fd8799f581c13867b04db054caa9655378fe37fedee7029924fbe1243887dc35fd8ffd87a80ffbf40bf401b000000024d5408caff581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5bf4754454d505552411b000000012a05f200ffffd87980d87a80ffffbf40bf401a0002d84dffffbf40bf4000ff581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5bf4754454d505552411b000000012a05f200ffff80a0d8799fd8799fd87a9f1b0000018a89e54678ffd87980ffd8799fd87a9f1b0000018a89e80598ffd87980ffff80bfd87a9fd8799fd8799f58202b5d1a4b36d928da9a48c53a1013656e559db63f1ec86c9673e1839e2b7999efff00ffffd87a9f503e8705789654a9a17fd08a91489591a4ffd8799f581c5d652c25b0a04ee11d00268e396520bff6171569ec2c71d541e366a5ffd87980ffa05820df29bc4cbf7ef15500c3af7b157d8f96303d6a47aa4c05bff63f590fe98c8738ffd87a9fd8799fd8799f58202b5d1a4b36d928da9a48c53a1013656e559db63f1ec86c9673e1839e2b7999efff00ffffff"
        );

        const res = Machine.eval(
            punsafeConvertType(
                contract
                .$( pData( datumData ) )
                .$( Redeemer.fromData( pData( rdmrData ) ) ),
                lam( data, unit )
            )
            .$( pData( ctxData ) )
        );

        expect( res.result instanceof UPLCConst ).toBe( true );
        expect( res.result ).toEqual( UPLCConst.unit );
    })

})